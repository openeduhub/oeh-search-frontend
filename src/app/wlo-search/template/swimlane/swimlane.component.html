<div class="wlo-grid wlo-grid-cols-6 wlo-gap">
  <ng-container *ngIf="grid?.length >= 1; else configureGridDialog">
    <div
      class="wlo-grid-content"
      [class.wlo-col-span-2]="gridItem.cols === 2"
      [class.wlo-col-span-3]="gridItem.cols === 3"
      [class.wlo-col-span-4]="gridItem.cols === 4"
      [class.wlo-col-span-6]="gridItem.cols === 6 || grid.length === 1"
      *ngFor="let gridItem of grid; let i = index"
    >
      <app-grid-widget
        *ngIf="supportedWidgetTypes.includes(gridItem.item); else selectWidgetTypeDialog"
        [backgroundColor]="backgroundColor ?? swimlaneColor"
        [contextNodeId]="contextNodeId"
        [editMode]="editMode"
        [gridIndex]="i"
        [pageVariantNode]="pageVariantNode"
        [selectDimensions]="selectDimensions"
        [selectedDimensionValues]="selectedDimensionValues"
        [swimlaneIndex]="swimlaneIndex"
        [topic]="topic"
        [widgetClasses]="gridItem.classNames"
        [widgetNodeId]="gridItem.nodeId?.includes(workspaceSpacesStorePrefix) ? gridItem.nodeId.split('/')?.[gridItem.nodeId.split('/').length - 1] : gridItem.nodeId"
        [widgetType]="gridItem.item"
        (nodeClicked)="clickedNode($event)"
      >
      </app-grid-widget>
      <!-- no (valid) widget type has been selected yet -->
      <ng-template #selectWidgetTypeDialog>
        <!-- display a form to select it when being in edit mode -->
        <div *ngIf="editMode" class="grid-border-container">
          <button
            class="btn-accent"
            mat-flat-button
            color="primary"
            [matMenuTriggerFor]="selectWidgetTypeMenu"
          >
            <i esIcon="add"></i> Widget hinzuf√ºgen
          </button>
          <mat-menu #selectWidgetTypeMenu="matMenu">
            <button
              mat-menu-item
              *ngFor="let option of widgetTypeOptions"
              (click)="selectWidgetType(option.value, i)"
            >
              {{ option.viewValue }}
            </button>
          </mat-menu>
        </div>
      </ng-template>
    </div>
  </ng-container>
  <!-- no grid has been defined yet -->
  <ng-template #configureGridDialog>
    <div class="grid-border-container wlo-col-span-6">
      <button
        class="btn-accent"
        mat-flat-button
        color="primary"
        [matMenuTriggerFor]="configureGridMenu"
      >
        <i esIcon="settings"></i> Grid konfigurieren
      </button>
      <mat-menu #configureGridMenu="matMenu">
        <button
          mat-menu-item
          *ngFor="let option of swimlaneGridOptions"
          (click)="configureSwimlaneGrid(option.value)"
        >
          <i
            class="material-icons-outlined"
            *ngIf="!!option.icon; else checkSvgIcon"
            [esIcon]="option.icon"
          ></i>
          <ng-template #checkSvgIcon>
            <mat-icon *ngIf="!!option.svgIcon" [svgIcon]="option.svgIcon"></mat-icon>
          </ng-template>
          {{ option.viewValue }}
        </button>
      </mat-menu>
    </div>
  </ng-template>
</div>
