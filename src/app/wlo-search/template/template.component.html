<header class="template-header">
  <div class="template-header-wrapper">
    <div class="template-header-container">
      <div class="template-header-content">
        <h1 i18n>Topic page for {{ topic() }}</h1>
        <p *ngIf="generatedHeader(); else headerPlaceholder">{{ generatedHeader() }}</p>
        <ng-template #headerPlaceholder>
          Dieser Text beschreibt das Thema der Seite und führt in es ein. Er ist typischerweise
          etwas länger und umfasst somit einige Sätze. Manche dieser Sätze haben vielen Kommata,
          andere nicht. Es können längere und kürzere Sätze dort vorkommen.
        </ng-template>
        <!-- action buttons for editing and creating -->
        <!-- duplicated code due to https://github.com/angular/components/issues/15367 -->
        <button
          mat-stroked-button
          class="edit-button"
          color="primary"
          (click)="editMode = !editMode"
          *ngIf="!editMode"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          mat-flat-button
          class="edit-button"
          color="primary"
          (click)="editMode = !editMode"
          *ngIf="editMode"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          mat-stroked-button
          class="add-button"
          color="primary"
          [matMenuTriggerFor]="addComponentMenu"
          *ngIf="editMode"
        >
          <mat-icon>add</mat-icon>
        </button>
        <mat-menu #addComponentMenu="matMenu">
          <button
            mat-menu-item
            *ngFor="let option of typeOptions"
            (click)="addColumn(option.value)"
          >
            {{ option.viewValue }}
          </button>
        </mat-menu>
      </div>
    </div>
  </div>
</header>
<div class="portal-plus-filterbar-wrapper">
  <div class="fachportal-filterbar"></div>
  <div class="portal-wrapper">
    <div class="portal-wrapper-left">
      <div
        class="wlo-column"
        [class.column-edit-mode]="editMode"
        *ngFor="let column of gridColumns; let i = index"
        [style.background-color]="column.backgroundColor ? column.backgroundColor : '#f4f4f4'"
      >
        <!-- action buttons for moving -->
        <div class="wlo-move-buttons" *ngIf="editMode">
          <button [disabled]="i === 0" (click)="moveColumnPosition(i, i - 1)">
            <mat-icon>arrow_upward</mat-icon>
          </button>
          <button [disabled]="i === gridColumns.length - 1" (click)="moveColumnPosition(i, i + 1)">
            <mat-icon>arrow_downward</mat-icon>
          </button>
        </div>
        <!-- action buttons for modifications -->
        <div class="wlo-edit-buttons" *ngIf="editMode">
          <button (click)="editColumn(column, i)" *ngIf="column.type !== 'spacer'">
            <mat-icon>settings</mat-icon>
          </button>
          <button [class.wlo-single-button]="column.type === 'spacer'" (click)="deleteColumn(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        <!-- type: collapse -->
        <cdk-accordion class="wlo-accordion" *ngIf="column.type === 'collapse'">
          <cdk-accordion-item
            #accordionItem="cdkAccordionItem"
            class="wlo-accordion-item"
            role="button"
            tabindex="0"
            [attr.id]="'accordion-header-' + i"
            [attr.aria-expanded]="accordionItem.expanded"
            [attr.aria-controls]="'accordion-body-' + i"
            expanded="true"
          >
            <div class="wlo-accordion-item-header" (click)="accordionItem.toggle()">
              <h2>{{ column.heading ?? 'Accordion Header' }}</h2>
              <span class="wlo-accordion-item-description">
                <mat-icon *ngIf="accordionItem.expanded">expand_less</mat-icon>
                <mat-icon *ngIf="!accordionItem.expanded">expand_more</mat-icon>
              </span>
            </div>
            <div
              class="wlo-accordion-item-body"
              role="region"
              [style.display]="accordionItem.expanded ? '' : 'none'"
              [attr.id]="'accordion-body-' + i"
              [attr.aria-labelledby]="'accordion-header-' + i"
            >
              <p class="wlo-description" *ngIf="column.description">{{ column.description }}</p>
              <app-column-grid
                [backgroundColor]="column.backgroundColor"
                [editMode]="editMode"
                [generatedJobText]="generatedJobText()"
                [grid]="column.grid"
                [gridType]="column.gridType"
                [jobsWidgetReady]="jobsWidgetReady"
                [selectDimensions]="selectDimensions"
                [topic]="topic()"
                [topicCollectionID]="topicCollectionID()"
                *ngIf="jobsWidgetReady"
              ></app-column-grid>
            </div>
          </cdk-accordion-item>
        </cdk-accordion>

        <!-- type: jumbotron, text, container -->
        <div
          [class.wlo-container]="column.type === 'container'"
          [class.wlo-jumbotron]="column.type === 'jumbotron'"
          [class.wlo-text]="column.type === 'text'"
          *ngIf="['container', 'jumbotron', 'text'].includes(column.type)"
        >
          <h2 *ngIf="column.heading">{{ column.heading }}</h2>
          <p class="wlo-description" *ngIf="column.description">{{ column.description }}</p>
          <app-column-grid
            [backgroundColor]="column.backgroundColor"
            [editMode]="editMode"
            [generatedJobText]="generatedJobText()"
            [grid]="column.grid"
            [jobsWidgetReady]="jobsWidgetReady"
            [selectDimensions]="selectDimensions"
            [topic]="topic()"
            [topicCollectionID]="topicCollectionID()"
            *ngIf="jobsWidgetReady"
          ></app-column-grid>
        </div>

        <ng-container *ngIf="column.type === 'spacer'">
          <hr class="wlo-spacer" />
        </ng-container>
      </div>
    </div>
  </div>
</div>
